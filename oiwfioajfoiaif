local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInput = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer

-- à¸ªà¸£à¹‰à¸²à¸‡ GUI
local ScreenGui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
ScreenGui.Name = "TargetSelector"
ScreenGui.ResetOnSpawn = false

local Frame = Instance.new("Frame", ScreenGui)
Frame.Name = "MainFrame"
Frame.Size = UDim2.new(0, 220, 0, 260)
Frame.Position = UDim2.new(0.03, 0, 0.4, 0)
Frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
Frame.BorderSizePixel = 0
Frame.Visible = true
Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 10)

local Title = Instance.new("TextLabel", Frame)
Title.Size = UDim2.new(1, 0, 0, 30)
Title.Text = "ðŸŽ¯ à¹€à¸¥à¸·à¸­à¸à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.BackgroundTransparency = 1
Title.Font = Enum.Font.GothamBold
Title.TextSize = 18

local Counter = Instance.new("TextLabel", Frame)
Counter.Size = UDim2.new(1, 0, 0, 20)
Counter.Position = UDim2.new(0, 0, 0, 30)
Counter.Text = "à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸: 0"
Counter.TextColor3 = Color3.fromRGB(180, 180, 180)
Counter.BackgroundTransparency = 1
Counter.Font = Enum.Font.Gotham
Counter.TextSize = 14

local RefreshBtn = Instance.new("TextButton", Frame)
RefreshBtn.Size = UDim2.new(0.94, 0, 0, 30)
RefreshBtn.Position = UDim2.new(0.03, 0, 0, 55)
RefreshBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
RefreshBtn.Font = Enum.Font.GothamBold
RefreshBtn.Text = "ðŸ”„ à¸£à¸µà¹€à¸Ÿà¸£à¸Šà¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­"
RefreshBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
RefreshBtn.TextSize = 14
Instance.new("UICorner", RefreshBtn).CornerRadius = UDim.new(0, 6)

-- à¸›à¸¸à¹ˆà¸¡à¸›à¸´à¸” (à¸¡à¸¸à¸¡à¸‚à¸§à¸²à¸šà¸™)
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 25, 0, 25)
CloseButton.Position = UDim2.new(1, -30, 0, 5)
CloseButton.BackgroundColor3 = Color3.fromRGB(120, 0, 0)
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.TextScaled = true
CloseButton.Parent = Frame

local CloseUICorner = Instance.new("UICorner")
CloseUICorner.CornerRadius = UDim.new(0, 6)
CloseUICorner.Parent = CloseButton

-- Scroll list
local Scroll = Instance.new("ScrollingFrame", Frame)
Scroll.Position = UDim2.new(0, 0, 0, 95)
Scroll.Size = UDim2.new(1, 0, 1, -100)
Scroll.BackgroundTransparency = 1
Scroll.ScrollBarThickness = 4
Scroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
Scroll.CanvasSize = UDim2.new(0, 0, 0, 0)

local ScrollList = Instance.new("UIListLayout", Scroll)
ScrollList.Padding = UDim.new(0, 4)
ScrollList.SortOrder = Enum.SortOrder.LayoutOrder

-- à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢
local TargetPlayers = {}

local function updateCounter()
	local count = 0
	for _ in pairs(TargetPlayers) do count += 1 end
	Counter.Text = "à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸: " .. count
end

local function updatePlayerList()
	for _, child in pairs(Scroll:GetChildren()) do
		if child:IsA("TextButton") then
			child:Destroy()
		end
	end

	for _, player in ipairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and player.Team ~= LocalPlayer.Team then
			local btn = Instance.new("TextButton", Scroll)
			btn.Size = UDim2.new(1, -10, 0, 30)
			btn.Text = player.Name
			btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
			btn.TextColor3 = Color3.fromRGB(255, 255, 255)
			btn.Font = Enum.Font.Gotham
			btn.TextSize = 14
			Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)

			btn.MouseButton1Click:Connect(function()
				if TargetPlayers[player.Name] then
					TargetPlayers[player.Name] = nil
					btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)

					if player.Character then
						local h = player.Character:FindFirstChild("TargetHighlight")
						if h then h:Destroy() end
					end
				else
					TargetPlayers[player.Name] = true
					btn.BackgroundColor3 = Color3.fromRGB(100, 0, 0)

					if player.Character and not player.Character:FindFirstChild("TargetHighlight") then
						local highlight = Instance.new("Highlight")
						highlight.Name = "TargetHighlight"
						highlight.FillColor = Color3.fromRGB(255, 0, 0)
						highlight.FillTransparency = 0.5
						highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
						highlight.OutlineTransparency = 0
						highlight.Adornee = player.Character
						highlight.Parent = player.Character
					end
				end

				updateCounter()
			end)
		end
	end

	task.wait()
	Scroll.CanvasSize = UDim2.new(0, 0, 0, ScrollList.AbsoluteContentSize.Y)
end

RefreshBtn.MouseButton1Click:Connect(updatePlayerList)
Players.PlayerAdded:Connect(updatePlayerList)
Players.PlayerRemoving:Connect(updatePlayerList)

updatePlayerList()
updateCounter()

-- Tween à¸›à¸´à¸”/à¹€à¸›à¸´à¸” GUI
local isGuiVisible = true
local elementsToTween = {Frame, Title, Counter, RefreshBtn, CloseButton}

local function tweenGUI(open)
	local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
	for _, el in pairs(elementsToTween) do
		if el:IsA("GuiObject") then
			TweenService:Create(el, tweenInfo, {
				BackgroundTransparency = open and 0 or 1
			}):Play()

			if el:IsA("TextLabel") or el:IsA("TextButton") then
				TweenService:Create(el, tweenInfo, {
					TextTransparency = open and 0 or 1
				}):Play()
			end
		end
	end
end

local function toggleGUI()
	if isGuiVisible then
		tweenGUI(false)
		task.delay(0.3, function()
			Frame.Visible = false
		end)
	else
		Frame.Visible = true
		tweenGUI(true)
	end
	isGuiVisible = not isGuiVisible
end

-- à¸›à¸´à¸”/à¹€à¸›à¸´à¸” GUI à¸”à¹‰à¸§à¸¢ RightShift
UserInput.InputBegan:Connect(function(input, gp)
	if input.KeyCode == Enum.KeyCode.RightShift and not gp then
		toggleGUI()
	end
end)

-- à¸›à¸´à¸” GUI à¸”à¹‰à¸§à¸¢à¸›à¸¸à¹ˆà¸¡ X
CloseButton.MouseButton1Click:Connect(function()
	tweenGUI(false)
	task.delay(0.3, function()
		ScreenGui:Destroy()
	end)
end)

-- à¸£à¸°à¸šà¸šà¹‚à¸ˆà¸¡à¸•à¸µ
local LastAttack = {}

RunService.RenderStepped:Connect(function()
	if LocalPlayer.Character then
		local tool = LocalPlayer.Character:FindFirstChildOfClass("Tool")
		if tool and tool:FindFirstChild("Gun") then
			for _, player in ipairs(Players:GetPlayers()) do
				if player ~= LocalPlayer and TargetPlayers[player.Name] then
					local char = player.Character
					if char and char:FindFirstChild("Head") and char:FindFirstChild("HumanoidRootPart") then
						local now = tick()
						local last = LastAttack[player.Name] or 0
						if now - last >= 0.25 then
							LastAttack[player.Name] = now
							task.spawn(function()
								pcall(function()
									getsenv(tool.Gun).DealDamage(char.Head, char.Head, "Melee")
								end)
							end)
						end
					end
				end
			end
		end
	end
end)
