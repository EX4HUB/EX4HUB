local players = game:GetService("Players")
local run_service = game:GetService("RunService")
local user_input = game:GetService("UserInputService")
local local_player = players.LocalPlayer

-- GUI
local screen_gui = Instance.new("ScreenGui", local_player:WaitForChild("PlayerGui"))
screen_gui.Name = "TargetSelector"
screen_gui.ResetOnSpawn = false

local frame = Instance.new("Frame", screen_gui)
frame.Position = UDim2.new(0, 20, 0.5, -120)
frame.Size = UDim2.new(0, 220, 0, 260)
frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
frame.BorderSizePixel = 0
frame.Visible = true

Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 8)

local ui_list = Instance.new("UIListLayout", frame)
ui_list.Padding = UDim.new(0, 4)
ui_list.SortOrder = Enum.SortOrder.LayoutOrder

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, 0, 0, 30)
title.Text = "ðŸŽ¯ à¹€à¸¥à¸·à¸­à¸à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.BackgroundTransparency = 1
title.Font = Enum.Font.GothamBold
title.TextSize = 18

local counter = Instance.new("TextLabel", frame)
counter.Size = UDim2.new(1, 0, 0, 20)
counter.Text = "à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸: 0"
counter.TextColor3 = Color3.fromRGB(180, 180, 180)
counter.BackgroundTransparency = 1
counter.Font = Enum.Font.Gotham
counter.TextSize = 14

local refresh_btn = Instance.new("TextButton", frame)
refresh_btn.Size = UDim2.new(1, 0, 0, 30)
refresh_btn.Text = "ðŸ”„ à¸£à¸µà¹€à¸Ÿà¸£à¸Šà¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­"
refresh_btn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
refresh_btn.TextColor3 = Color3.fromRGB(255, 255, 255)
refresh_btn.Font = Enum.Font.GothamBold
refresh_btn.TextSize = 14
Instance.new("UICorner", refresh_btn).CornerRadius = UDim.new(0, 6)

local scroll = Instance.new("ScrollingFrame", frame)
scroll.Size = UDim2.new(1, 0, 1, -110)
scroll.CanvasSize = UDim2.new(0, 0, 0, 0)
scroll.ScrollBarThickness = 4
scroll.BackgroundTransparency = 1
scroll.AutomaticCanvasSize = Enum.AutomaticSize.Y

local scroll_list = Instance.new("UIListLayout", scroll)
scroll_list.Padding = UDim.new(0, 4)
scroll_list.SortOrder = Enum.SortOrder.LayoutOrder

-- à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸
local target_players = {}

-- à¸­à¸±à¸›à¹€à¸”à¸• counter
local function updateCounter()
    local count = 0
    for _ in pairs(target_players) do count += 1 end
    counter.Text = "à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸: " .. count
end

-- à¸­à¸±à¸›à¹€à¸”à¸•à¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹€à¸¥à¹ˆà¸™
local function updatePlayerList()
    for _, v in pairs(scroll:GetChildren()) do
        if v:IsA("TextButton") then v:Destroy() end
    end

    for _, player in pairs(players:GetPlayers()) do
        if player ~= local_player and player.Team ~= local_player.Team then
            local btn = Instance.new("TextButton", scroll)
            btn.Size = UDim2.new(1, -10, 0, 30)
            btn.Text = player.Name
            btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
            btn.TextColor3 = Color3.fromRGB(255, 255, 255)
            btn.Font = Enum.Font.Gotham
            btn.TextSize = 14
            Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)

            btn.MouseButton1Click:Connect(function()
                if target_players[player.Name] then
                    target_players[player.Name] = nil
                    btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)

                    -- à¸¥à¸š Highlight à¸–à¹‰à¸²à¸¡à¸µ
                    if player.Character then
                        local highlight = player.Character:FindFirstChild("TargetHighlight")
                        if highlight then
                            highlight:Destroy()
                        end
                    end
                else
                    target_players[player.Name] = true
                    btn.BackgroundColor3 = Color3.fromRGB(100, 0, 0)

                    -- à¸ªà¸£à¹‰à¸²à¸‡ Highlight
                    if player.Character and not player.Character:FindFirstChild("TargetHighlight") then
                        local highlight = Instance.new("Highlight")
                        highlight.Name = "TargetHighlight"
                        highlight.FillColor = Color3.fromRGB(255, 0, 0)
                        highlight.FillTransparency = 0.5
                        highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
                        highlight.OutlineTransparency = 0
                        highlight.Adornee = player.Character
                        highlight.Parent = player.Character
                    end
                end

                updateCounter()
            end)
        end
    end
end

-- à¸›à¸¸à¹ˆà¸¡à¸£à¸µà¹€à¸Ÿà¸£à¸Š
refresh_btn.MouseButton1Click:Connect(updatePlayerList)
players.PlayerAdded:Connect(updatePlayerList)
players.PlayerRemoving:Connect(updatePlayerList)

updatePlayerList()
updateCounter()

-- à¸›à¸´à¸”/à¹€à¸›à¸´à¸” GUI à¸”à¹‰à¸§à¸¢ RightShift
user_input.InputBegan:Connect(function(input, gp)
    if input.KeyCode == Enum.KeyCode.RightShift and not gp then
        frame.Visible = not frame.Visible
    end
end)

-- à¸£à¸°à¸šà¸šà¹‚à¸ˆà¸¡à¸•à¸µ (à¸žà¸£à¹‰à¸­à¸¡ cooldown à¸•à¹ˆà¸­à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢)
local last_attack = {}

run_service.RenderStepped:Connect(function()
    if local_player.Character then
        local tool = local_player.Character:FindFirstChildOfClass("Tool")
        if tool and tool:FindFirstChild("Gun") then
            for _, player in pairs(players:GetPlayers()) do
                if player ~= local_player and target_players[player.Name] then
                    local char = player.Character
                    if char and char:FindFirstChild("Head") and char:FindFirstChild("HumanoidRootPart") then
                        local now = tick()
                        local last = last_attack[player.Name] or 0
                        if now - last >= 0.25 then
                            last_attack[player.Name] = now
                            task.spawn(function()
                                pcall(function()
                                    getsenv(tool.Gun).DealDamage(char.Head, char.Head, "Melee")
                                end)
                            end)
                        end
                    end
                end
            end
        end
    end
end)
